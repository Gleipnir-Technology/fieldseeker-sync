{{template "base.html" .}}

{{define "title"}}Nidus Audio{{end}}

{{define "style"}}
html, body {
	height: 100%;
	margin: 0;
}
.btn.speed {
	font-size: 12px;
	margin: 0px;
	padding: 0px;
}
.container-audio {
	width: 100%;
	height: auto;
	padding: 20px;
	border-radius: 5px;
	background-color: #eee;
	color: #444;
	margin: 20px auto;
	overflow: hidden;
}
.audio-ruler {
	width: 85%;
	height: 30px;
	left: 60px;
	position: relative;
	background-color: #f0f0f0;
}

#glossarySidebar {
			height: 100%;
			width: 0;
			position: fixed;
			z-index: 1000;
			top: 0;
			right: 0;
			background-color: #f1f1f1;
			overflow-x: hidden;
			transition: 0.5s;
			padding-top: 60px;
		}

		#glossarySidebar.show {
			width: 300px;
		}

		.glossary-item {
			padding: 10px 15px;
			border-bottom: 1px solid #ddd;
			cursor: pointer;
		}
.ruler-marks {
	display: flex;
	height: 100%;
	position: absolute;
	width: 100%;
}
.ruler-mark {
	flex-grow: 1;
	border-right: 1px solid #999;
	position: relative;
}



.ruler-label {
	position: absolute;
	bottom: -20px;
	transform: translateX(-50%);
	font-size: 10px;
	color: #666;
}
audio {
	width:100%;
}
{{end}}

{{define "extrajs"}}
<script src="/static/js/audio.js"></script>
<script>
function setPlaybackSpeed(speed) {
	var audio = document.getElementById("audio")
	audio.playbackRate=speed;
}
onload = (event) => {
	// Toggle Glossary Sidebar
	document.getElementById('toggleGlossary').addEventListener('click', function() {
		document.getElementById('glossarySidebar').classList.add('show');
	});

	// Close Glossary Sidebar
	document.getElementById('closeGlossary').addEventListener('click', function() {
		document.getElementById('glossarySidebar').classList.remove('show');
	});

	// Initialize Popovers
	var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
	var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
		return new bootstrap.Popover(popoverTriggerEl)
	});
}
</script>
{{end}}

{{define "content"}}
<!-- Glossary Sidebar -->
<div id="glossarySidebar">
	<div class="d-flex justify-content-between align-items-center px-3 mb-3">
		<h3>Glossary</h3>
		<button id="closeGlossary" class="btn-close"></button>
	</div>
	
	<div id="glossaryList">
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is the name for the life stages of the mosquito, so you will hear them say 'First Instar' or 'Firsts.'">
			Instar
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="These are the transitional life stages of mosquitoes, singular and plural respectively.">
			Pupa or Pupae
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="These are the juvenile life stages of mosquitoes, singular or plural respectively.">
			Larva or Larvae
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is a state of female mosquitoes, meaning they are carrying eggs. There are gravid mosquitoes and gravid traps designed to capture gravid mosquitoes.">
			Gravid
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="These are a variety of mosquito traps. They may also say BGs (plural), meaning multiple BG Sentinel traps. (BG stands for BioGents and is basically a brand name, but most people call the traps by the brand name.)">
			BG, BG Sentinel, Sentinel
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is carbon dioxide, and it refers to the gas but also to a variety of traps that use CO₂ as bait.">
			CO₂
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is an irrigation method where water is pumped to a tall standing pipe and then gravity feeds the water into the field. They will often be full of mosquitoes.">
			Standpipe
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content=" This is a large pond where the manure from the feed lanes is washed to keep it from piling up at the dairy. They often produce mosquitoes.">
			Dairy Lagoon
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is usually a natural temporary waterway that will hold stagnant water near rivers.">
			Slough
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is a genus of mosquito that represents several species we deal with regularly. They often indicate day biting and aggressive behavior.">
			Aedes
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is a genus of mosquito that represents several species we deal with regularly. They are more sneaky than Aedes and are our primary vectors in disease transmission.">
			Culex
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is usually a natural temporary waterway that will hold stagnant water near rivers. ie 'aegypti source'">
			Aegypti
		</div>
		<div class="glossary-item"
			data-bs-toggle="popover"
			data-bs-trigger="hover"
			data-bs-content="This is a genus of mosquito that represents several species we deal with regularly. They often indicate day biting and aggressive behavior.">
			Quinks
		</div>
	</div>
</div>
<div class="container">
	<a href="/process-audio">Return to list</a>
	<div class="row">
		<div class="col-11">
			<div class="container-audio">
				<audio controls id="audio">
					<source src="/audio/{{ .Task.NoteAudioUUID }}.m4a" type="audio/mpeg"></source>
					<source src="/audio/{{ .Task.NoteAudioUUID }}.ogg" type="audio/ogg"></source>
				</audio>
				<div class="audio-ruler">
					<div class="ruler-marks" id="rulerMarks"></div>
				</div>
			</div>
		</div>
		<div class="col-1">
			<button class="btn speed" onclick="setPlaybackSpeed(0.5)">0.5x</button>
			<button class="btn speed" onclick="setPlaybackSpeed(0.75)">0.75x</button>
			<button class="btn speed" onclick="setPlaybackSpeed(1.0)">1.0x</button>
			<button class="btn speed" onclick="setPlaybackSpeed(1.25)">1.25x</button>
			<button class="btn speed" onclick="setPlaybackSpeed(1.5)">1.5x</button>
			<button class="btn speed" onclick="setPlaybackSpeed(1.75)">1.75x</button>
			<button class="btn speed" onclick="setPlaybackSpeed(2.0)">2.0x</button>
		</div>
	</div>
	<div class="row">
		<div class="col">
			<form method="POST" action="/process-audio/{{ .Task.ID }}/reviewed">
				<button type="submit" class="btn btn-success">Mark reviewed without changes</button>
			</form>
		</div>
		<div class="col">
			<form method="POST" action="/process-audio/{{ .Task.ID }}/needs-further-review">
				<button type="submit" class="btn btn-warning">Needs further review</button>
			</form>
		</div>
		<div class="col">
			<button id="toggleGlossary" class="btn btn-primary">
				Show Glossary
				</button>
		</div>
	</div>
	<form method="POST" action="/process-audio/{{ .Task.ID }}">
		<div class="mb-3">
			<p><b>Original transcription:</b><br/>{{ if .NoteAudio.Transcription.IsValue }}{{ .NoteAudio.Transcription.MustGet }}{{ else }}&lt;none&gt;{{ end }}</p>
		</div>
		<div class="mb-3">
			<input type="hidden" name="uuid" value="{{ .NoteAudio.UUID }}"/>
			<label for="transcript" class="form-label">Updated Transcription</label>
			<textarea class="form-control" name="transcription" rows="10">{{ if .NoteAudio.Transcription.IsValue }}{{ .NoteAudio.Transcription.MustGet }}{{ else }}{{ end }}</textarea>
			<button type="submit" class="btn btn-primary">Update</button>
		</div>
	</form>
	<div class="row">
		<div class="col-4">
			<table class="table">
				<tbody>
					<tr>
						<td>Created</td>
						<td>{{ timeSince .NoteAudio.Created }}</td>
					</tr>
					<tr>
						<td>Creator</td>
						<td>{{ with $u := index $.UsersById .NoteAudio.Creator }}{{ $u.DisplayName }}{{ end }}</td>
					</tr>
					{{ if .NoteAudio.Deleted.IsValue }}
					<tr>
						<td>Deleted</td>
						<td>{{ timeSince .NoteAudio.Deleted }}</td>
					</tr>
					{{ else }}{{ end }}
					<tr>
						<td>Duration</td>
						<td>{{ timeElapsed .NoteAudio.Duration }}</td>
					</tr>
					<tr>
						<td>Transcription user edited</td>
						<td>{{ .NoteAudio.TranscriptionUserEdited }}</td>
					</tr>
					<tr>
						<td>Version</td>
						<td>{{ .NoteAudio.Version }}</td>
					</tr>
					<tr>
						<td>UUID</td>
						<td>{{ .NoteAudio.UUID }}</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<div class="row">
		<form method="POST" action="/process-audio/{{ .NoteAudio.UUID }}/delete">
			<button type="submit" class="btn btn-danger">Delete</button>
		</form>
	</div>
</div>
{{end}}

{{define "script"}}
{{end}}
