{{template "base.html" .}}

{{define "title"}}Nidus Audio{{end}}

{{define "style"}}
html, body {
	height: 100%;
	margin: 0;
}
.container-audio {
	width: 66%;
	height: auto;
	padding: 20px;
	border-radius: 5px;
	background-color: #eee;
	color: #444;
	margin: 20px auto;
	overflow: hidden;
}
audio {
	width:100%;
}
{{end}}

{{define "extrajs"}}
<script>
function setPlaybackSpeed(speed) {
	var audio = document.getElementById("audio")
	audio.playbackRate=speed;
}
onload = (event) => {
	console.log("loaded");
}
</script>
{{end}}

{{define "content"}}
<div class="container">
	<a href="/process-audio">Return to list</a>
	<div class="row">
		<div class="col-11">
			<div class="container-audio">
				<audio controls id="audio">
					<source src="/audio/{{ .AudioNote.UUID }}.m4a" type="audio/mpeg"></source>
					<source src="/audio/{{ .AudioNote.UUID }}.ogg" type="audio/ogg"></source>
				</audio>
			</div>
		</div>
		<div class="col-1">
			<button class="btn" onclick="setPlaybackSpeed(0.5)"/>0.5x</button>
			<button class="btn" onclick="setPlaybackSpeed(0.75)"/>0.75x</button>
			<button class="btn" onclick="setPlaybackSpeed(1.0)"/>1.0x</button>
			<button class="btn" onclick="setPlaybackSpeed(1.25)"/>1.25x</button>
			<button class="btn" onclick="setPlaybackSpeed(1.5)"/>1.5x</button>
			<button class="btn" onclick="setPlaybackSpeed(1.75)"/>1.75x</button>
			<button class="btn" onclick="setPlaybackSpeed(2.0)"/>2.0x</button>
		</div>
	</div>
	<table class="table">
		<tbody>
			<tr>
				<td>Created</td>
				<td>{{ .AudioNote.Created }}</td>
			</tr>
			<tr>
				<td>Creator</td>
				<td>{{ with $u := index $.UsersById .AudioNote.Creator }}{{ $u.DisplayName }}{{ end }}</td>
			</tr>
			<tr>
				<td>Deleted</td>
				<td>{{ .AudioNote.Deleted }}</td>
			</tr>
			<tr>
				<td>Duration</td>
				<td>{{ .AudioNote.Duration }}</td>
			</tr>
			<tr>
				<td>Transcription user edited</td>
				<td>{{ .AudioNote.TranscriptionUserEdited }}</td>
			</tr>
			<tr>
				<td>Version</td>
				<td>{{ .AudioNote.Version }}</td>
			</tr>
			<tr>
				<td>UUID</td>
				<td>{{ .AudioNote.UUID }}</td>
			</tr>
		</tbody>
	</table>
	<div class="row">
		<div class="col">
			<form method="POST" action="/process-audio/{{ .AudioNote.UUID }}/reviewed">
				<button type="submit" class="btn btn-success">Mark reviewed without changes</button>
			</form>
		</div>
		<div class="col">
			<form method="POST" action="/process-audio/{{ .AudioNote.UUID }}/needs-further-review">
				<button type="submit" class="btn btn-warning">Needs further review</button>
			</form>
		</div>
	</div>
	<form method="POST" action="/process-audio/{{ .AudioNote.UUID }}">
		<div class="mb-3">
			<p><b>Original transcription:</b><br/>{{ if not .AudioNote.Transcription }}&lt;none&gt;{{ else }}{{ .AudioNote.Transcription }}{{ end }}</p>
		</div>
		<div class="mb-3">
			<input type="hidden" name="uuid" value="{{ .AudioNote.UUID }}"/>
			<label for="transcript" class="form-label">Updated Transcription</label>
			<textarea class="form-control" name="transcription" rows="10">{{ if not .AudioNote.Transcription }}{{ else }}{{ .AudioNote.Transcription }}{{ end }}</textarea>
			<button type="submit" class="btn btn-primary">Update</button>
		</div>
	</form>
</div>
{{end}}

{{define "script"}}
{{end}}
